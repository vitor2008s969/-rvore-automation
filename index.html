const puppeteer = require('puppeteer-extra');
const StealthPlugin = require('puppeteer-extra-plugin-stealth');
const readline = require('readline-sync');

puppeteer.use(StealthPlugin());

(async () => {
  // Configura√ß√£o
  const config = {
    headless: false,
    credentials: {
      username: readline.question('Digite seu usu√°rio do Leia SP: '),
      password: readline.question('Digite sua senha: ', { hideEchoBack: true })
    },
    bookUrl: readline.question('Cole a URL do livro: ')
  };

  const browser = await puppeteer.launch({ headless: config.headless });
  const page = await browser.newPage();

  try {
    // Login
    await page.goto('https://leia.sp.gov.br/login');
    await page.type('#username', config.credentials.username);
    await page.type('#password', config.credentials.password);
    await page.click('#login-button');
    await page.waitForNavigation();

    // Acessar livro
    await page.goto(config.bookUrl);
    
    // Automa√ß√£o (simplificada)
    let pageNumber = 1;
    while (true) {
      console.log(`üìñ P√°gina ${pageNumber}`);
      
      // Verificar quest√µes
      const questions = await page.$$('.question');
      for (const question of questions) {
        await question.click(); // Simula resposta
      }
      
      // Pr√≥xima p√°gina
      const nextButton = await page.$('.next-page');
      if (!nextButton) break;
      await nextButton.click();
      await page.waitForTimeout(2000);
      pageNumber++;
    }

    console.log('‚úÖ Livro conclu√≠do!');

  } catch (error) {
    console.error('‚ùå Erro:', error);
  } finally {
    await browser.close();
  }
})();
